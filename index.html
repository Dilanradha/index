// Modify resizeCanvas to prevent clearing on resize if there's a signature
function resizeCanvas() {
    const ratio = Math.max(window.devicePixelRatio || 1, 1);
    canvas.width = canvas.offsetWidth * ratio;
    canvas.height = canvas.offsetHeight * ratio;
    canvas.getContext("2d").scale(ratio, ratio);

    // Only clear if the canvas is empty
    if (signaturePad.isEmpty()) {
        signaturePad.clear();
    }
}

// Enhanced save function with loading indicator
function saveSignature() {
    if (signaturePad.isEmpty()) {
        alert("Please provide a signature.");
        return;
    }

    const dataURL = signaturePad.toDataURL();
    const loadingMessage = "Saving signature...";
    
    // Show loading message
    alert(loadingMessage);
    
    fetch("https://script.google.com/macros/s/AKfycbw7iSTSWTxUBz5Lvt-dnwbM7rvead3_bHg6kiJMukorIJyhlKzcIgQlWeUwM5ZTlWg/exec", {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ image: dataURL })
    }).then(response => {
        alert("Signature saved!");
        signaturePad.clear(); // Clear after saving
    }).catch(error => {
        console.error("Error:", error);
        alert("Failed to save signature.");
    });
}
